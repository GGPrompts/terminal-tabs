.terminal-container {
  display: flex;
  flex-direction: column;
  border-radius: var(--radius-lg);
  overflow: hidden;
  min-height: 300px;
  height: 100%;
  transition: all var(--transition-base);
  border: 1px solid rgba(255, 255, 255, 0.1);
  position: relative;
  isolation: isolate;
}

/* Apply opacity to background only - text remains full brightness */
.terminal-container::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(23, 23, 23, 0.6);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  opacity: var(--terminal-opacity, 1);
  z-index: -1;
}

.terminal-container.maximized {
  position: fixed;
  top: var(--nav-height);
  left: 0;
  right: 0;
  bottom: 0;
  z-index: var(--z-modal);
  margin: 0;
  border-radius: 0;
}

.terminal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  user-select: none;
  position: relative;
  z-index: 1;
}

.terminal-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.terminal-icon {
  font-size: 1.25rem;
}

.terminal-name {
  font-weight: var(--font-weight-semibold);
  color: var(--color-neutral-100);
}

.terminal-type {
  font-size: var(--font-size-sm);
  color: var(--color-neutral-400);
}

.terminal-actions {
  display: flex;
  gap: 0.5rem;
}

.terminal-action-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: var(--color-neutral-200);
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-size: var(--font-size-sm);
}

.terminal-action-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.2);
}

.terminal-action-btn.terminal-close:hover {
  background: rgba(248, 113, 113, 0.2);
  border-color: rgba(248, 113, 113, 0.3);
  color: var(--color-error);
}

.terminal-body {
  flex: 1;
  overflow: hidden;
  /* Semi-transparent background to ensure clicks register while keeping glassmorphism */
  background: rgba(0, 0, 0, 0.1);
  /* Comfortable padding to prevent text from touching borders */
  padding: 4px 8px 4px 12px;
  box-sizing: border-box;
  position: relative;
  z-index: 1;
}

.terminal-body .xterm {
  height: 100%;
  width: 100% !important;
  background: transparent !important;
  /* Padding is now on .terminal-body container for proper spacing */
  margin: 0 !important;
}

.terminal-body .xterm-screen {
  height: 100%;
  background: transparent !important;
}

.terminal-body .xterm-viewport {
  background-color: transparent !important; /* keep xterm transparent so container provides blur */
  width: 100% !important;
}

/* Ensure xterm canvas and all elements are transparent */
.terminal-body canvas {
  background: transparent !important;
}

/* Force xterm terminal background to be transparent */
.terminal-body .xterm-screen canvas {
  background-color: transparent !important;
}

/* Remove theme text glows inside the terminal for crisp box-drawing */
.terminal-body .xterm,
.terminal-body .xterm * {
  text-shadow: none !important;
  filter: none !important;
}
.terminal-body .xterm {
  font-variant-ligatures: none;
}

/* Hide scrollbar for tmux sessions (tmux handles scrollback) */
.terminal-tmux .terminal-body .xterm-viewport::-webkit-scrollbar {
  display: none !important;
}

.terminal-tmux .terminal-body .xterm-viewport {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
}

/* Show styled scrollbar for non-tmux sessions */
.terminal-no-tmux .terminal-body .xterm-viewport::-webkit-scrollbar {
  width: 10px;
}

.terminal-no-tmux .terminal-body .xterm-viewport::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}

.terminal-no-tmux .terminal-body .xterm-viewport::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 4px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

.terminal-no-tmux .terminal-body .xterm-viewport::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.5);
  background-clip: padding-box;
}

.terminal-no-tmux .terminal-body .xterm-viewport {
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: rgba(255, 255, 255, 0.3) rgba(0, 0, 0, 0.3); /* Firefox */
}

/* Override any default xterm backgrounds */
.terminal-body .xterm .xterm-screen {
  background-color: transparent !important;
}

.terminal-body .xterm-helper-textarea {
  background-color: transparent !important;
}

/* Ensure xterm rows don't clip content */
.terminal-body .xterm-rows {
  white-space: pre !important;
}

/* Embedded mode (when outer chrome supplied by draggable wrapper) */
.terminal-container.embedded .terminal-header,
.terminal-container.embedded .terminal-status {
  display: none;
}

.terminal-container.embedded .terminal-body {
  padding: 0;
  background: transparent; /* Background controlled by parent container */
}

.terminal-container.embedded {
  border: none !important; /* Remove border for clean appearance */
  background: transparent !important; /* Ensure container itself is transparent */
}

/* Keep the terminal's background overlay (controlled by --terminal-opacity)
   active for embedded terminals by default so the slider works in the
   Command Dispatcher. Only suppress it when the terminal is inside the
   draggable canvas container to avoid double layering there. */
.draggable-terminal-container .terminal-container.embedded::before {
  display: none !important;
}

/* Ensure embedded terminals remain visually transparent containers */
/* EXCEPT for TUI tools like PyRadio which need opaque backgrounds */
.qt-terminal-dock .terminal-container:not(.terminal-tui-tool),
.quick-terminal-viewport .terminal-container:not(.terminal-tui-tool) {
  background: transparent !important;
}

/* Most TUI tools need solid black background for proper rendering */
.qt-terminal-dock .terminal-container.terminal-tui-tool:not(.terminal-pyradio),
.quick-terminal-viewport .terminal-container.terminal-tui-tool:not(.terminal-pyradio) {
  background: rgba(0, 0, 0, 1) !important;
}

/* PyRadio with light theme needs white background */
.qt-terminal-dock .terminal-container.terminal-pyradio,
.quick-terminal-viewport .terminal-container.terminal-pyradio {
  background: rgba(255, 255, 255, 1) !important;
}

/* Prevent embedded terminals from blocking clicks outside their area */
.terminal-container.embedded {
  pointer-events: auto;
}

/* Allow clicking through the terminal when it's not focused */
.terminal-container.embedded .xterm-helper-textarea:not(:focus) {
  pointer-events: none !important;
}

/* Ensure proper cursor display */
.terminal-container.embedded .xterm-screen {
  cursor: default !important;
}

/* Only show text cursor when actually hovering over terminal text */
.terminal-container.embedded .xterm-rows {
  cursor: text;
}

.terminal-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  font-size: var(--font-size-xs);
  color: var(--color-neutral-400);
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-neutral-500);
  animation: pulse 2s infinite;
}

.status-indicator.active {
  background: var(--color-success);
}

.status-indicator.spawning {
  background: var(--color-warning);
  animation: pulse 1s infinite;
}

.status-indicator.error {
  background: var(--color-error);
}

.status-indicator.closed {
  background: var(--color-neutral-500);
  animation: none;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.status-text {
  text-transform: uppercase;
  font-weight: var(--font-weight-medium);
}

.terminal-pid {
  margin-left: auto;
  color: var(--color-neutral-500);
}

/* Terminal type color accents */
.terminal-claude-code .terminal-header {
  border-top: 2px solid var(--color-primary-500);
}

.terminal-opencode .terminal-header {
  border-top: 2px solid var(--color-secondary-500);
}

.terminal-gemini .terminal-header {
  border-top: 2px solid var(--color-accent-500);
}

.terminal-docker-ai .terminal-header {
  border-top: 2px solid var(--color-info-500);
}

.terminal-orchestrator .terminal-header {
  border-top: 2px solid var(--color-warning);
}

.terminal-bash .terminal-header {
  border-top: 2px solid var(--color-neutral-500);
}

.terminal-dashboard .terminal-header {
  border-top: 2px solid var(--color-danger);
}
